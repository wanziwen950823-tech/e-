<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ‰«ç å¹³å°ï¼ˆåºåˆ—å· + UPC + æ¯æ—¥æ€»æ±‡ + å¯å±•å¼€æ˜ç»†ï¼‰</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-50 text-gray-900">
  <div class="max-w-7xl mx-auto p-4 md:p-6">
    <h1 class="text-2xl md:text-3xl font-bold mb-4">
      ğŸ“¦ æ‰«ç å¹³å° <span class="text-sm text-gray-500 font-normal">ï¼ˆåºåˆ—å· + UPC + æ¯æ—¥æ€»æ±‡ + æ˜ç»†ï¼‰</span>
    </h1>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- æ‰«ç å½•å…¥ -->
      <section class="bg-white rounded-2xl shadow-sm p-4 md:p-6">
        <h2 class="text-lg font-semibold mb-2">æ‰«ç å½•å…¥</h2>
        <div class="space-y-2">
          <input id="upc" class="border rounded w-full p-2" placeholder="UPCï¼ˆå¯é‡å¤ï¼‰" />
          <input id="sn" class="border rounded w-full p-2" placeholder="åºåˆ—å·ï¼ˆå”¯ä¸€ï¼‰" />
          <input id="device" class="border rounded w-full p-2" placeholder="è®¾å¤‡ Device" />
          <input id="capacity" class="border rounded w-full p-2" placeholder="å®¹é‡ Capacity" />
          <input id="color" class="border rounded w-full p-2" placeholder="é¢œè‰² Color" />
          <button id="addScan" class="px-4 py-2 bg-blue-600 text-white rounded">å½•å…¥</button>
        </div>
      </section>

      <!-- è¿å•ç™»è®° -->
      <section class="bg-white rounded-2xl shadow-sm p-4 md:p-6">
        <h2 class="text-lg font-semibold mb-2">è¿å•ç™»è®°</h2>
        <div class="space-y-2">
          <input id="awbCode" class="border rounded w-full p-2" placeholder="è¿å•å·ï¼ˆå¿…å¡«ï¼‰" />
          <input id="awbCarrier" class="border rounded w-full p-2" placeholder="ç‰©æµå…¬å¸ï¼ˆå¯é€‰ï¼‰" />
          <input id="awbDate" type="date" class="border rounded w-full p-2" />
          <button id="addAwb" class="px-4 py-2 bg-green-600 text-white rounded">ç™»è®°è¿å•</button>
        </div>
        <div class="mt-4">
          <h3 class="font-semibold mb-1">å·²ç™»è®°è¿å•</h3>
          <div id="awbList" class="text-sm space-y-1"></div>
        </div>
      </section>
    </div>

    <!-- æ¯æ—¥æ€»æ±‡ -->
    <section class="bg-white rounded-2xl shadow-sm p-4 md:p-6 mt-6">
      <h2 class="text-lg font-semibold mb-2">ğŸ“… æ¯æ—¥æ€»æ±‡ï¼ˆå¯å±•å¼€æ˜ç»†ï¼‰</h2>
      <div id="dailySummary" class="space-y-2 text-sm"></div>
    </section>
  </div>

<script>
  const scans = JSON.parse(localStorage.getItem('scans_v1') || '[]');
  const awbs = JSON.parse(localStorage.getItem('awbs_v1') || '[]');
  const dailySummary = document.getElementById('dailySummary');
  const awbList = document.getElementById('awbList');

  function renderAll() {
    // æ¸²æŸ“è¿å•åˆ—è¡¨
    awbList.innerHTML = awbs.map(a => `<div>${a.date} Â· ${a.code} <span class='text-gray-500'>${a.carrier||''}</span></div>`).join('');

    // æ•´ç†æ¯æ—¥æ±‡æ€»
    const summary = {};
    for (const s of scans) {
      const d = s.time.split(' ')[0];
      if (!summary[d]) summary[d] = { scan: [], awb: [] };
      summary[d].scan.push(s);
    }
    for (const a of awbs) {
      const d = a.date || new Date().toISOString().slice(0,10);
      if (!summary[d]) summary[d] = { scan: [], awb: [] };
      summary[d].awb.push(a);
    }

    // ç”Ÿæˆæ¯æ—¥å¡ç‰‡ï¼ˆå¯å±•å¼€ï¼‰
    const sorted = Object.entries(summary).sort((a,b)=>b[0].localeCompare(a[0]));
    dailySummary.innerHTML = sorted.map(([d,v]) => `
      <details class='border rounded-lg bg-gray-50'>
        <summary class='p-2 flex justify-between cursor-pointer'>
          <div>${d}</div>
          <div>æ‰«ç ï¼š<strong>${v.scan.length}</strong> ï½œ è¿å•ï¼š<strong>${v.awb.length}</strong></div>
        </summary>
        <div class='p-3 bg-white border-t'>
          <h4 class='font-semibold text-sm mb-1'>ğŸ“‹ æ‰«ææ˜ç»† (${v.scan.length} æ¡)</h4>
          <table class='w-full text-xs border mb-3'>
            <thead class='bg-gray-100'>
              <tr>
                <th class='border p-1'>æ—¶é—´</th>
                <th class='border p-1'>UPC</th>
                <th class='border p-1'>åºåˆ—å·</th>
                <th class='border p-1'>è®¾å¤‡</th>
                <th class='border p-1'>å®¹é‡</th>
                <th class='border p-1'>é¢œè‰²</th>
              </tr>
            </thead>
            <tbody>
              ${v.scan.map(s => `<tr><td class='border p-1'>${s.time}</td><td class='border p-1'>${s.upc}</td><td class='border p-1'>${s.sn}</td><td class='border p-1'>${s.device}</td><td class='border p-1'>${s.capacity}</td><td class='border p-1'>${s.color}</td></tr>`).join('')}
            </tbody>
          </table>
          <h4 class='font-semibold text-sm mb-1'>ğŸ§¾ è¿å•æ˜ç»† (${v.awb.length} å•)</h4>
          <ul class='list-disc list-inside text-xs'>
            ${v.awb.map(a => `<li>${a.code} ${a.carrier? 'Â· '+a.carrier:''}</li>`).join('')}
          </ul>
        </div>
      </details>`).join('');
  }

  document.getElementById('addScan').onclick = () => {
    const upc = document.getElementById('upc').value.trim();
    const sn = document.getElementById('sn').value.trim();
    if (!upc && !sn) return alert('è¯·è¾“å…¥UPCæˆ–åºåˆ—å·');
    if (sn && scans.some(r => r.sn === sn)) return alert('åºåˆ—å·å·²å­˜åœ¨');
    scans.push({
      time: new Date().toLocaleString('zh-CN',{hour12:false}),
      upc, sn,
      device: document.getElementById('device').value.trim(),
      capacity: document.getElementById('capacity').value.trim(),
      color: document.getElementById('color').value.trim()
    });
    localStorage.setItem('scans_v1', JSON.stringify(scans));
    renderAll();
  };

  document.getElementById('addAwb').onclick = () => {
    const code = document.getElementById('awbCode').value.trim();
    if (!code) return alert('è¯·è¾“å…¥è¿å•å·');
    const carrier = document.getElementById('awbCarrier').value.trim();
    const date = document.getElementById('awbDate').value || new Date().toISOString().slice(0,10);
    awbs.push({ code, carrier, date });
    localStorage.setItem('awbs_v1', JSON.stringify(awbs));
    renderAll();
  };

  renderAll();
</script>
</body>
</html>
