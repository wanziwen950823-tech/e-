<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>å·¥ä¸šæ‰«ç å¹³å° Â· å•ç æª / FS40 / FS42 é€šç”¨ç‰ˆ</title>
<style>
:root {
  --bg:#0b0f14;--panel:#121821;--card:#0e141d;--accent:#27e6a7;
  --accent2:#00b3ff;--text:#e7eef7;--muted:#9db0c3;
  --bd:#1d2732;--warn:#ffb648;--bad:#ff6b6b;
}
body {margin:0;background:var(--bg);color:var(--text);
font-family:ui-sans-serif,system-ui,"Segoe UI",Roboto,"Noto Sans SC";}
h2{margin-top:0}
.container {max-width:1200px;margin:auto;padding:24px}
.card {background:var(--panel);padding:16px;border-radius:12px;margin-bottom:16px;
box-shadow:0 4px 20px rgba(0,0,0,.25)}
input,button {font-size:15px;padding:10px;border-radius:8px;border:1px solid var(--bd);
background:var(--card);color:var(--text);outline:none}
button {cursor:pointer;background:linear-gradient(90deg,var(--accent),var(--accent2));border:none}
button:hover {opacity:.9}
.table {width:100%;border-collapse:collapse;font-size:14px}
.table th,.table td {padding:8px;border-top:1px solid var(--bd)}
.table th {background:#0c121a;color:#9db0c3}
.detail td{background:#0a121a}
.muted{color:var(--muted)}
.flex{display:flex;gap:10px;flex-wrap:wrap}
input:focus{border-color:var(--accent)}
</style>
</head>
<body>
<div class="container">
  <h1>ğŸ“¦ å·¥ä¸šæ‰«ç å¹³å° <small style="color:var(--muted)">ï¼ˆå•ç æª & FS40/FS42 å…¼å®¹ï¼‰</small></h1>

  <div class="card">
    <h2>ğŸšš è¿å•ç™»è®°</h2>
    <div class="flex">
      <input id="trkTag" placeholder="æ ‡è®° (Tag) å¦‚ A001" />
      <input id="tracking" placeholder="æ‰«ææˆ–è¾“å…¥è¿å•å·" />
      <button id="addTracking">æ·»åŠ </button>
    </div>
    <small class="muted">FedEx è‡ªåŠ¨å–å 12 ä½æ•°å­—ï¼›UPS ä»¥ 1Z å¼€å¤´åŸæ ·ä¿ç•™ã€‚</small>
  </div>

  <div class="card">
    <h2>ğŸ“± è®¾å¤‡ç™»è®°</h2>
    <div class="flex">
      <input id="devTag" placeholder="æ ‡è®° (Tag)" />
      <input id="serial" placeholder="åºåˆ—å· Serial" />
      <input id="upc" placeholder="UPCï¼ˆå¯è‡ªåŠ¨åŒ¹é…ï¼‰" />
      <button id="addDevice">æ·»åŠ </button>
    </div>
    <div class="flex">
      <input id="device" placeholder="Device" />
      <input id="capacity" placeholder="Capacity" />
      <input id="color" placeholder="Color" />
    </div>
  </div>

  <div class="card">
    <h2>ğŸ§© SKU æ˜ å°„å¯¼å…¥</h2>
    <input type="file" id="skuUpload" accept=".csv" />
    <p class="muted">æ ¼å¼ï¼šUPC,Device,Capacity,Colorï¼ˆå¯¼å…¥åè‡ªåŠ¨ç¼“å­˜ï¼‰</p>
    <button id="exportAll">å¯¼å‡ºå…¨éƒ¨æ•°æ® CSV</button>
    <button style="background:var(--bad)" id="clearAll">æ¸…ç©ºæ•°æ®</button>
  </div>

  <div class="card">
    <h2>ğŸ“Š æ±‡æ€»æ€»è§ˆ</h2>
    <table class="table" id="summary"><thead>
      <tr><th>Tag</th><th>è¿å•æ•°é‡</th><th>è®¾å¤‡æ•°é‡</th><th>æœ€è¿‘æ—¶é—´</th></tr>
    </thead><tbody></tbody></table>
  </div>
</div>

<script>
let trackingData = JSON.parse(localStorage.getItem('tracks')||'[]');
let deviceData = JSON.parse(localStorage.getItem('devices')||'[]');
let skuMap = JSON.parse(localStorage.getItem('skuMap')||'{}');

function now(){return new Date().toISOString();}
function fmt(t){return new Date(t).toLocaleString('zh-CN',{hour12:false});}
function save(){localStorage.setItem('tracks',JSON.stringify(trackingData));
                localStorage.setItem('devices',JSON.stringify(deviceData));}

/* --- FedEx/UPS è‡ªåŠ¨è¯†åˆ« --- */
function normalizeTracking(v){
  v=String(v).trim(); if(!v) return null;
  if(v.startsWith('1Z')) return {carrier:'UPS',number:v};
  let digits=v.replace(/\D+/g,''); if(digits.length>=12)
    return {carrier:'FedEx',number:digits.slice(-12)};
  return {carrier:'Other',number:v};
}

/* --- æ·»åŠ è¿å• --- */
document.getElementById('addTracking').onclick=()=>{
  const tag=document.getElementById('trkTag').value.trim();
  const raw=document.getElementById('tracking').value.trim();
  if(!tag||!raw) return alert('è¯·å¡«å†™ Tag ä¸è¿å•å·');
  const t=normalizeTracking(raw);
  trackingData.push({tag,carrier:t.carrier,number:t.number,time:now()});
  save(); renderSummary(); document.getElementById('tracking').value='';
};

/* --- æ·»åŠ è®¾å¤‡ --- */
document.getElementById('addDevice').onclick=()=>{
  const tag=document.getElementById('devTag').value.trim();
  const serial=document.getElementById('serial').value.trim();
  const upc=document.getElementById('upc').value.trim();
  if(!tag||!serial) return alert('è¯·å¡«å†™ Tag ä¸ Serial');
  const info=skuMap[upc]; 
  deviceData.push({
    tag,serial,upc,
    device:info?.device||document.getElementById('device').value.trim(),
    capacity:info?.capacity||document.getElementById('capacity').value.trim(),
    color:info?.color||document.getElementById('color').value.trim(),
    time:now()
  });
  save(); renderSummary();
  ['serial','upc','device','capacity','color'].forEach(id=>document.getElementById(id).value='');
};

/* --- SKU å¯¼å…¥ --- */
document.getElementById('skuUpload').onchange=e=>{
  const file=e.target.files[0]; if(!file) return;
  const r=new FileReader();
  r.onload=ev=>{
    const rows=ev.target.result.split(/\r?\n/);
    skuMap={};
    rows.slice(1).forEach(line=>{
      const [u,d,c,col]=line.split(',');
      if(u) skuMap[u.trim()]={device:d,capacity:c,color:col};
    });
    localStorage.setItem('skuMap',JSON.stringify(skuMap));
    alert('SKU æ˜ å°„å·²å¯¼å…¥ï¼š'+Object.keys(skuMap).length+' æ¡');
  };
  r.readAsText(file);
};

/* --- å¯¼å‡º/æ¸…ç©º --- */
document.getElementById('exportAll').onclick=()=>{
  let csv='type,tag,time,carrier/serial,number/upc,device,capacity,color\n';
  trackingData.forEach(t=>{
    csv+=`tracking,${t.tag},${fmt(t.time)},${t.carrier},${t.number},,,\n`;
  });
  deviceData.forEach(d=>{
    csv+=`device,${d.tag},${fmt(d.time)},${d.serial},${d.upc},${d.device},${d.capacity},${d.color}\n`;
  });
  const blob=new Blob([csv],{type:'text/csv'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);a.download='scan_export.csv';a.click();
};
document.getElementById('clearAll').onclick=()=>{
  if(confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼Ÿ')){
    trackingData=[];deviceData=[];save();renderSummary();
  }
};

/* --- æ±‡æ€» --- */
function renderSummary(){
  const tb=document.querySelector('#summary tbody');tb.innerHTML='';
  const tags=[...new Set([...trackingData.map(x=>x.tag),...deviceData.map(x=>x.tag)])];
  tags.forEach(tag=>{
    const trk=trackingData.filter(x=>x.tag===tag);
    const dev=deviceData.filter(x=>x.tag===tag);
    const all=[...trk,...dev].sort((a,b)=>a.time.localeCompare(b.time));
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${tag}</td>
      <td>${trk.length}</td><td>${dev.length}</td>
      <td class="muted">${all.length?fmt(all.slice(-1)[0].time):'-'}</td>`;
    tb.appendChild(tr);
  });
}
renderSummary();

/* --- å…¼å®¹æ‰«ææªï¼šè‡ªåŠ¨èšç„¦è¾“å…¥æ¡† --- */
document.addEventListener('keydown',()=>{
  const trk=document.getElementById('tracking');
  if(document.activeElement!==trk && !trk.value) trk.focus();
});
</script>
</body>
</html>
