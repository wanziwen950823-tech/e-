<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æ‰«ç å¹³å° Â· è¿å•å· + åºåˆ—å· + SKU è‡ªåŠ¨è¯†åˆ«</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body { background: #f8fafc; font-family: ui-sans-serif, system-ui; }
.card { background: #fff; border-radius: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08); padding: 1.5rem; margin-top: 1.5rem; }
.btn { background: #2563eb; color: #fff; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; }
.btn:hover { background: #1e40af; }
input, select { border: 1px solid #ddd; border-radius: 0.375rem; padding: 0.4rem; }
table { width: 100%; border-collapse: collapse; }
th, td { border: 1px solid #ddd; padding: 0.5rem; text-align: center; }
th { background: #f1f5f9; }
tr:nth-child(even) { background: #f9fafb; }
textarea { width: 100%; height: 60px; border: 1px solid #ccc; border-radius: 0.375rem; padding: 0.5rem; }
</style>
</head>

<body class="p-6">
  <h1 class="text-2xl font-bold text-gray-800 mb-4">ğŸ“¦ Apple æ‰«ç ç™»è®°å¹³å°</h1>
  <p class="text-gray-600 mb-6">æ”¯æŒï¼šè¿å•å·ç™»è®° + åºåˆ—å·/UPCç™»è®° + SKUè‡ªåŠ¨åŒ¹é… + æ‰‹åŠ¨å…³è” + CSVå¯¼å‡º</p>

  <!-- SKU å¯¼å…¥ -->
  <div class="card">
    <h2 class="text-xl font-semibold mb-3">ğŸ”— SKU æ˜ å°„è¡¨</h2>
    <button class="btn" onclick="document.getElementById('skuUpload').click()">ä¸Šä¼  SKU æ˜ å°„ï¼ˆCSVï¼‰</button>
    <input type="file" id="skuUpload" accept=".csv" style="display:none">
    <span id="skuStatus" class="ml-3 text-sm text-gray-600"></span>
  </div>

  <!-- è¿å•å·ç™»è®° -->
  <div class="card">
    <h2 class="text-xl font-semibold mb-3">ğŸšš è¿å•å·ç™»è®°</h2>
    <div class="flex gap-2 mb-3">
      <input type="text" id="mark" placeholder="æ ‡è®°ç¼–å· (ä¾‹: A001)" class="w-1/4">
      <input type="text" id="tracking" placeholder="è¿å•å· (FedEx/UPS)" class="flex-1">
      <button class="btn" onclick="addTracking()">ç™»è®°è¿å•å·</button>
    </div>
    <table id="trackingTable">
      <thead><tr><th>æ ‡è®°ç¼–å·</th><th>è¿å•å·</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- åºåˆ—å·/UPC ç™»è®° -->
  <div class="card">
    <h2 class="text-xl font-semibold mb-3">ğŸ“± åºåˆ—å· / UPC ç™»è®°</h2>
    <div class="flex gap-2 mb-3">
      <input type="text" id="refMark" placeholder="å…³è”æ ‡è®° (ä¾‹: A001)" class="w-1/4">
      <input type="text" id="serial" placeholder="åºåˆ—å·" class="w-1/4">
      <input type="text" id="upc" placeholder="UPC" class="w-1/4">
      <input type="text" id="device" placeholder="Device" class="w-1/5 device">
      <input type="text" id="capacity" placeholder="Capacity" class="w-1/5 capacity">
      <input type="text" id="color" placeholder="Color" class="w-1/5 color">
      <button class="btn" onclick="addDevice()">ç™»è®°è®¾å¤‡</button>
    </div>
    <table id="deviceTable">
      <thead><tr><th>æ ‡è®°ç¼–å·</th><th>åºåˆ—å·</th><th>UPC</th><th>Device</th><th>Capacity</th><th>Color</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- å¯¼å‡º -->
  <div class="card">
    <h2 class="text-xl font-semibold mb-3">ğŸ’¾ æ•°æ®å¯¼å‡º</h2>
    <button class="btn" onclick="exportCSV()">å¯¼å‡ºæ‰€æœ‰æ•°æ® (CSV)</button>
  </div>

<script>
let skuMap = {};
let trackingData = [];
let deviceData = [];

// ä¸Šä¼  SKU CSV
document.getElementById('skuUpload').addEventListener('change', e => {
  if (e.target.files.length > 0) loadSkuMap(e.target.files[0]);
});

function loadSkuMap(file) {
  const reader = new FileReader();
  reader.onload = e => {
    const rows = e.target.result.split(/\r?\n/);
    rows.slice(1).forEach(row => {
      const [upc, device, capacity, color] = row.split(',');
      if (upc) skuMap[upc.trim()] = {device, capacity, color};
    });
    localStorage.setItem('skuMap', JSON.stringify(skuMap));
    document.getElementById('skuStatus').innerText = `âœ… SKU æ˜ å°„åŠ è½½æˆåŠŸï¼Œå…± ${Object.keys(skuMap).length} æ¡`;
  };
  reader.readAsText(file, 'utf-8');
}

// åŠ è½½ç¼“å­˜ SKU
window.addEventListener('load', () => {
  const cached = localStorage.getItem('skuMap');
  if (cached) {
    skuMap = JSON.parse(cached);
    document.getElementById('skuStatus').innerText = `âœ… å·²åŠ è½½ç¼“å­˜æ˜ å°„ ${Object.keys(skuMap).length} æ¡`;
  }
});

// è‡ªåŠ¨åŒ¹é… UPC
document.getElementById('upc').addEventListener('input', e => {
  const upc = e.target.value.trim();
  const sku = skuMap[upc];
  if (sku) {
    document.getElementById('device').value = sku.device || '';
    document.getElementById('capacity').value = sku.capacity || '';
    document.getElementById('color').value = sku.color || '';
  }
});

// æ·»åŠ è¿å•å·
function addTracking() {
  const mark = document.getElementById('mark').value.trim();
  let tracking = document.getElementById('tracking').value.trim();
  if (!mark || !tracking) return alert('è¯·å¡«å†™æ ‡è®°ç¼–å·ä¸è¿å•å·');
  if (tracking.startsWith('96') || tracking.length > 12) tracking = tracking.slice(-12); // FedEx æˆªå–å12ä½
  trackingData.push({ mark, tracking });
  updateTrackingTable();
  document.getElementById('mark').value = '';
  document.getElementById('tracking').value = '';
}

function updateTrackingTable() {
  const tbody = document.querySelector('#trackingTable tbody');
  tbody.innerHTML = '';
  trackingData.forEach(item => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${item.mark}</td><td>${item.tracking}</td>`;
    tbody.appendChild(tr);
  });
}

// æ·»åŠ è®¾å¤‡
function addDevice() {
  const refMark = document.getElementById('refMark').value.trim();
  const serial = document.getElementById('serial').value.trim();
  const upc = document.getElementById('upc').value.trim();
  const device = document.getElementById('device').value.trim();
  const capacity = document.getElementById('capacity').value.trim();
  const color = document.getElementById('color').value.trim();
  if (!serial && !upc) return alert('è¯·è¾“å…¥åºåˆ—å·æˆ–UPC');
  deviceData.push({ refMark, serial, upc, device, capacity, color });
  updateDeviceTable();
  document.getElementById('serial').value = '';
  document.getElementById('upc').value = '';
  document.getElementById('device').value = '';
  document.getElementById('capacity').value = '';
  document.getElementById('color').value = '';
}

// æ›´æ–°è®¾å¤‡è¡¨
function updateDeviceTable() {
  const tbody = document.querySelector('#deviceTable tbody');
  tbody.innerHTML = '';
  deviceData.forEach(item => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${item.refMark}</td><td>${item.serial}</td><td>${item.upc}</td><td>${item.device}</td><td>${item.capacity}</td><td>${item.color}</td>`;
    tbody.appendChild(tr);
  });
}

// å¯¼å‡ºæ‰€æœ‰æ•°æ®
function exportCSV() {
  let csv = 'æ ‡è®°ç¼–å·,è¿å•å·,åºåˆ—å·,UPC,Device,Capacity,Color\n';
  deviceData.forEach(dev => {
    const match = trackingData.find(t => t.mark === dev.refMark);
    csv += `${dev.refMark},${match ? match.tracking : ''},${dev.serial},${dev.upc},${dev.device},${dev.capacity},${dev.color}\n`;
  });
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'scan_export.csv';
  a.click();
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>
