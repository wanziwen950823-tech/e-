<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æ‰«ç å¹³å° Â· Appleè‡ªåŠ¨è¯†åˆ« + æ±‡æ€»</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body { background: #f7f9fb; font-family: ui-sans-serif, system-ui; }
.card { background: #fff; border-radius: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08); padding: 1.5rem; margin-top: 1.5rem; }
.btn { background: #2563eb; color: #fff; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; }
.btn:hover { background: #1d4ed8; }
input, select { border: 1px solid #ddd; border-radius: 0.375rem; padding: 0.4rem; }
table { width: 100%; border-collapse: collapse; }
th, td { border: 1px solid #ddd; padding: 0.5rem; text-align: center; }
th { background: #f3f4f6; }
tr:nth-child(even) { background: #fafafa; }
</style>
</head>

<body class="p-6">
  <h1 class="text-2xl font-bold text-gray-800 mb-2">ğŸ“¦ Apple æ‰«ç ç™»è®°å¹³å°</h1>
  <p class="text-gray-600 mb-6">æ”¯æŒï¼šUPC è‡ªåŠ¨è¯†åˆ«å‹å·/å®¹é‡/é¢œè‰²ï¼ˆæ•°æ®æ¥è‡ª Google Sheetï¼‰</p>

  <div class="card">
    <h2 class="text-xl font-semibold mb-3">ğŸ”— SKU æ˜ å°„è¿æ¥</h2>
    <input type="text" id="sheetUrl" class="w-full mb-2" placeholder="è¯·è¾“å…¥ä½ çš„ Google Sheet é“¾æ¥" value="https://docs.google.com/spreadsheets/d/1lalx-2-FhcH0dM7_60DQotTmWaZojaPxn955MLXDaTk/edit#gid=0">
    <button class="btn" onclick="loadSKU()">åŠ è½½ SKU æ˜ å°„</button>
    <span id="skuStatus" class="ml-3 text-sm text-gray-600"></span>
  </div>

  <div class="card">
    <h2 class="text-xl font-semibold mb-3">ğŸ“± è®¾å¤‡ç™»è®°</h2>
    <div class="flex gap-2 mb-3">
      <input type="text" id="upc" placeholder="UPC" class="flex-1">
      <input type="text" id="device" placeholder="Device" class="w-1/4 device">
      <input type="text" id="capacity" placeholder="Capacity" class="w-1/4 capacity">
      <input type="text" id="color" placeholder="Color" class="w-1/4 color">
      <button class="btn" onclick="addRow()">ç™»è®°</button>
    </div>

    <table id="dataTable">
      <thead>
        <tr><th>UPC</th><th>Device</th><th>Capacity</th><th>Color</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
// --- SKU_MAP è‡ªåŠ¨è¯†åˆ«é€»è¾‘ ---
let skuMap = {};

async function loadSKU() {
  const url = document.getElementById('sheetUrl').value.trim();
  const csvUrl = url.replace('/edit#gid=', '/gviz/tq?tqx=out:csv&gid=');
  document.getElementById('skuStatus').innerText = 'åŠ è½½ä¸­...';

  try {
    const res = await fetch(csvUrl);
    const text = await res.text();
    const rows = text.split(/\r?\n/).slice(1);
    skuMap = {};
    rows.forEach(row => {
      const [upc, device, capacity, color] = row.split(',');
      if (upc) skuMap[upc.trim()] = { device, capacity, color };
    });

    localStorage.setItem('skuMap', JSON.stringify(skuMap));
    document.getElementById('skuStatus').innerText = `âœ… å·²åŠ è½½ ${Object.keys(skuMap).length} æ¡ SKU æ˜ å°„`;
  } catch (err) {
    document.getElementById('skuStatus').innerText = 'âŒ åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥é“¾æ¥æ˜¯å¦å…¬å¼€';
  }
}

window.addEventListener('load', () => {
  const cache = localStorage.getItem('skuMap');
  if (cache) {
    skuMap = JSON.parse(cache);
    document.getElementById('skuStatus').innerText = `âœ… å·²åŠ è½½ç¼“å­˜æ˜ å°„ ${Object.keys(skuMap).length} æ¡`;
  }
});

document.getElementById('upc').addEventListener('input', e => {
  const upc = e.target.value.trim();
  const sku = skuMap[upc];
  if (sku) {
    document.getElementById('device').value = sku.device || '';
    document.getElementById('capacity').value = sku.capacity || '';
    document.getElementById('color').value = sku.color || '';
  }
});

function addRow() {
  const upc = document.getElementById('upc').value.trim();
  const device = document.getElementById('device').value.trim();
  const capacity = document.getElementById('capacity').value.trim();
  const color = document.getElementById('color').value.trim();
  if (!upc) return alert('è¯·å¡«å†™ UPC');

  const tbody = document.querySelector('#dataTable tbody');
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>${upc}</td><td>${device}</td><td>${capacity}</td><td>${color}</td>`;
  tbody.appendChild(tr);

  document.getElementById('upc').value = '';
  document.getElementById('device').value = '';
  document.getElementById('capacity').value = '';
  document.getElementById('color').value = '';
  document.getElementById('upc').focus();
}
</script>

</body>
</html>
